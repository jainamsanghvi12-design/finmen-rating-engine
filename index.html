<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FINMEN Rating Intelligence - AI Powered</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1400px; margin: 0 auto; background: #fff; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,.3); overflow: hidden; }
    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 40px 20px; text-align: center; }
    .header h1 { font-size: 2.5em; margin-bottom: 10px; }
    .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; overflow-x: auto; }
    .tab-btn { flex: 1; padding: 15px; border: none; background: 0; cursor: pointer; font-size: .95em; font-weight: 500; color: #666; min-width: 120px; white-space: nowrap; }
    .tab-btn.active { background: #fff; color: #667eea; border-bottom: 3px solid #667eea; }
    .tab-content { display: none; padding: 30px; }
    .tab-content.active { display: block; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
    label .req::after { content: " *"; color: red; }
    input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; }
    textarea { min-height: 150px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 12px 30px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; margin-top: 10px; }
    button:hover { opacity: 0.9; }
    .alert { padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid; }
    .alert-info { background: #d1ecf1; color: #0c5460; border-left-color: #17a2b8; }
    .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .data-table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 15px; text-align: left; font-weight: 600; }
    .data-table td { padding: 12px 15px; border-bottom: 1px solid #ddd; }
    .peer-card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 15px; }
    .peer-card h4 { margin-bottom: 10px; color: #667eea; }
    .peer-card h5 { margin-bottom: 10px; }
    .score { background: #667eea; color: #fff; padding: 5px 10px; border-radius: 3px; font-weight: 600; margin-left: 10px; }
    .section-title { font-size: 1.3em; font-weight: 700; margin: 20px 0 15px 0; color: #667eea; }
    .opportunity-item { padding: 15px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid; }
    .opportunity-item.upgrade { background: #fff3cd; border-left-color: #ffc107; }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìä FINMEN Rating Intelligence</h1>
    <p style="font-size: 1.1em; margin-top: 10px;">AI-Powered Rating Analysis & Peer Matching</p>
  </div>
  
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab(event, 'input')">üìù Input</button>
    <button class="tab-btn" onclick="switchTab(event, 'analysis')">ü§ñ Analysis</button>
    <button class="tab-btn" onclick="switchTab(event, 'data')">üìä Data</button>
  </div>
  
  <div id="input" class="tab-content active">
    <div class="alert alert-info">
      ‚ö° PRODUCTION - AI Analysis | Peer Matching | Opportunity Flagging
    </div>
    
    <h2>Submit Company Rating</h2>
    <div class="form-row">
      <div class="form-group">
        <label><span class="req">Company Name</span></label>
        <input type="text" id="company" placeholder="e.g., Ashiana Housing Limited">
      </div>
      <div class="form-group">
        <label><span class="req">Rating Agency</span></label>
        <select id="agency" required>
          <option value="">-- Select Agency --</option>
          <option value="CRISIL">CRISIL</option>
          <option value="ICRA">ICRA</option>
          <option value="CARE">CARE Ratings</option>
          <option value="Infomerics">Infomerics</option>
          <option value="Acuite">Acuite</option>
          <option value="Brickwork">Brickwork</option>
          <option value="India Ratings">India Ratings</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label><span class="req">Industry</span></label>
        <input type="text" id="industry" placeholder="e.g., Real Estate, Banking, NBFC, etc.">
      </div>
      <div class="form-group">
        <label><span class="req">Rating</span></label>
        <select id="rating" required>
          <option value="">-- Select Rating --</option>
          <option value="AAA">AAA</option>
          <option value="AA+">AA+</option>
          <option value="AA">AA</option>
          <option value="AA-">AA-</option>
          <option value="A+">A+</option>
          <option value="A">A</option>
          <option value="A-">A-</option>
          <option value="BBB+">BBB+</option>
          <option value="BBB">BBB</option>
          <option value="BBB-">BBB-</option>
          <option value="BB+">BB+</option>
          <option value="BB">BB</option>
          <option value="BB-">BB-</option>
          <option value="B+">B+</option>
          <option value="B">B</option>
          <option value="B-">B-</option>
          <option value="C">C</option>
          <option value="D">D</option>
          <option value="NR">NR</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label><span class="req">Outlook</span></label>
        <select id="outlook" required>
          <option value="">-- Select Outlook --</option>
          <option value="Positive">Positive</option>
          <option value="Stable">Stable</option>
          <option value="Negative">Negative</option>
          <option value="Developing">Developing</option>
        </select>
      </div>
      <div class="form-group">
        <label><span class="req">Rating Action</span></label>
        <select id="action" required>
          <option value="">-- Select Action --</option>
          <option value="Initial Rating">Initial Rating</option>
          <option value="Upgrade">Upgrade</option>
          <option value="Downgrade">Downgrade</option>
          <option value="Affirmed">Affirmed</option>
          <option value="Withdrawn">Withdrawn</option>
        </select>
      </div>
    </div>
    
    <div class="form-group">
      <label><span class="req">Rating Rationale (PDF, Word, or Text)</span></label>
      <input type="file" id="rationale_file" accept=".pdf,.docx,.txt,.doc" required>
      <small style="color: #666; display: block; margin-top: 5px;">Upload the rating rationale document or press release</small>
    </div>
    
    <div class="form-group">
      <label>Summary (Optional)</label>
      <textarea id="summary" placeholder="Optional: Add any additional notes or summary..."></textarea>
    </div>
    
    <button onclick="submitRating()">üì§ Submit & Analyze</button>
  </div>
  
  <div id="analysis" class="tab-content">
    <div id="analysisContent">
      <p style="color: #999; text-align: center; padding: 40px;">Submit a rating to see AI analysis here</p>
    </div>
  </div>
  
  <div id="data" class="tab-content">
    <h2>All Submitted Ratings</h2>
    <div id="dataTable">
      <p style="color: #999;">No data yet</p>
    </div>
  </div>
</div>

<script>
let ratingsData = JSON.parse(localStorage.getItem('finmenRatings')) || [];

const sampleCompanies = [
  { name: 'Lodha Group', industry: 'Real Estate', rating: 'A+', agency: 'ICRA' },
  { name: 'Prestige Estates', industry: 'Real Estate', rating: 'A', agency: 'CARE' },
  { name: 'Oberoi Realty', industry: 'Real Estate', rating: 'AA-', agency: 'CRISIL' },
  { name: 'Kotak Bank', industry: 'Banking', rating: 'AAA', agency: 'CRISIL' },
  { name: 'HDFC Bank', industry: 'Banking', rating: 'AA+', agency: 'ICRA' },
  { name: 'ICICI Bank', industry: 'Banking', rating: 'AA+', agency: 'CARE' },
  { name: 'Axis Bank', industry: 'Banking', rating: 'AA', agency: 'CRISIL' },
  { name: 'Bajaj Finance', industry: 'NBFC', rating: 'AAA', agency: 'ICRA' },
  { name: 'HDFC Ltd', industry: 'NBFC', rating: 'AA+', agency: 'CRISIL' },
  { name: 'Reliance Industries', industry: 'Energy', rating: 'AAA', agency: 'CRISIL' }
];

function switchTab(e, t) {
  document.querySelectorAll('.tab-content').forEach(a => a.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(a => a.classList.remove('active'));
  document.getElementById(t).classList.add('active');
  e.target.classList.add('active');
  if (t === 'data') displayData();
}

function submitRating() {
  const company = document.getElementById('company').value;
  const agency = document.getElementById('agency').value;
  const industry = document.getElementById('industry').value;
  const rating = document.getElementById('rating').value;
  const outlook = document.getElementById('outlook').value;
  const action = document.getElementById('action').value;
  const file = document.getElementById('rationale_file').files[0];
  const summary = document.getElementById('summary').value;
  
  if (!company || !agency || !industry || !rating || !outlook || !action || !file) {
    alert('Please fill all required fields (marked with *)');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const rationale_text = e.target.result;
    
    const record = {
      id: Date.now(),
      company: company,
      agency: agency,
      industry: industry,
      rating: rating,
      outlook: outlook,
      action: action,
      rationale_file: file.name,
      rationale_text: rationale_text,
      summary: summary,
      timestamp: new Date().toLocaleString()
    };
    
    ratingsData.push(record);
    localStorage.setItem('finmenRatings', JSON.stringify(ratingsData));
    
    analyzeRating(record);
    alert('‚úÖ Rating submitted! Analyzing...');
    
    // Clear form
    document.getElementById('company').value = '';
    document.getElementById('agency').value = '';
    document.getElementById('industry').value = '';
    document.getElementById('rating').value = '';
    document.getElementById('outlook').value = '';
    document.getElementById('action').value = '';
    document.getElementById('rationale_file').value = '';
    document.getElementById('summary').value = '';
  };
  reader.readAsText(file);
}

function analyzeRating(c) {
  const peers = findPeers(c);
  const opps = flagOpportunities(c, peers);
  
  document.getElementById('analysisContent').innerHTML = `
    <div class="section-title">ü§ñ AI Analysis: ${c.company}</div>
    <div class="peer-card">
      <h5>üìã Company Profile</h5>
      <p><strong>Industry:</strong> ${c.industry}</p>
      <p><strong>Rating:</strong> ${c.rating} (${c.agency})</p>
      <p><strong>Outlook:</strong> ${c.outlook}</p>
      <p><strong>Action:</strong> ${c.action}</p>
    </div>
    <div class="section-title">üë• Matched Peers</div>
    <div id="peersList"></div>
    <div class="section-title">üö© Opportunities</div>
    <div id="oppList"></div>
  `;
  
  displayPeers(peers);
  displayOpp(opps);
  
  // Switch to analysis tab
  document.querySelectorAll('.tab-content').forEach(a => a.classList.remove('active'));
  document.querySelectorAll
